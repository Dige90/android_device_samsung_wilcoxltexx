From cb89548f8ddaae025fb4f45871057d4949c4f6fe Mon Sep 17 00:00:00 2001
From: Arne Coucheron <arco68@gmail.com>
Date: Tue, 28 Oct 2014 01:55:04 +0100
Subject: [PATCH] Switch to TimeService blobs

Change-Id: I64b6a147f66459a8a348cc02a4cf00e9aad34fd7
---
 BoardConfigCommon.mk  |  3 ---
 proprietary-files.txt |  4 +++-
 setup-makefiles.sh    | 26 +++++++++++++++++++++++++-
 3 files changed, 28 insertions(+), 5 deletions(-)

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index c8e2c4a..a70d41b 100644
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -89,9 +89,6 @@ TARGET_NEED_DISABLE_FACE_DETECTION := true
 TARGET_NEED_DISABLE_FACE_DETECTION_BOTH_CAMERAS := true
 TARGET_VIDEO_PREVIEW_ALWAYS_MAX := true
 
-# Time services
-BOARD_USES_QC_TIME_SERVICES := true
-
 # Build our own PowerHAL
 TARGET_POWERHAL_VARIANT :=
 
diff --git a/proprietary-files.txt b/proprietary-files.txt
index 88aae7d..735f643 100644
--- a/proprietary-files.txt
+++ b/proprietary-files.txt
@@ -75,8 +75,10 @@ vendor/lib/libqmiservices.so
 vendor/lib/libril-qcril-hook-oem.so
 
 # Time services
+-app/TimeService.apk
 bin/time_daemon
-lib/libtime_genoff.so
+-lib/libtime_genoff.so
+-lib/libTimeService.so
 
 # GPS
 bin/irsc_util
diff --git a/setup-makefiles.sh b/setup-makefiles.sh
index b00689d..0e4dbc2 100755
--- a/setup-makefiles.sh
+++ b/setup-makefiles.sh
@@ -52,7 +52,10 @@ done
 # This file is generated by device/$VENDOR/$DEVICE/setup-makefiles.sh
 
 # Pick up overlay for features that depend on non-open-source files
-PRODUCT_PACKAGES += libtime_genoff
+PRODUCT_PACKAGES += \\
+    libtime_genoff \\
+    libTimeService \\
+    TimeService
 
 \$(call inherit-product, vendor/$VENDOR/$DEVICE/$DEVICE-vendor-blobs.mk)
 EOF
@@ -102,6 +105,27 @@ include \$(CLEAR_VARS)
 LOCAL_MODULE := libtime_genoff
 LOCAL_MODULE_OWNER := samsung
 LOCAL_SRC_FILES := proprietary/lib/libtime_genoff.so
+LOCAL_MODULE_PATH := \$(TARGET_OUT_SHARED_LIBRARIES)
+LOCAL_MODULE_TAGS := optional
+LOCAL_MODULE_SUFFIX := .so
+LOCAL_MODULE_CLASS := SHARED_LIBRARIES
+include \$(BUILD_PREBUILT)
+
+include \$(CLEAR_VARS)
+LOCAL_MODULE := TimeService
+LOCAL_MODULE_OWNER := samsung
+LOCAL_SRC_FILES := proprietary/app/TimeService.apk
+LOCAL_MODULE_TAGS := optional
+LOCAL_MODULE_SUFFIX := \$(COMMON_ANDROID_PACKAGE_SUFFIX)
+LOCAL_MODULE_CLASS := APPS
+LOCAL_CERTIFICATE := platform
+include \$(BUILD_PREBUILT)
+
+include \$(CLEAR_VARS)
+LOCAL_MODULE := libTimeService
+LOCAL_MODULE_OWNER := samsung
+LOCAL_SRC_FILES := proprietary/lib/libTimeService.so
+LOCAL_MODULE_PATH := \$(TARGET_OUT_SHARED_LIBRARIES)
 LOCAL_MODULE_TAGS := optional
 LOCAL_MODULE_SUFFIX := .so
 LOCAL_MODULE_CLASS := SHARED_LIBRARIES
